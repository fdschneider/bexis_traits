---
title: "Example 1"
output:  
  pdf_document:
    includes:
      in_header: header.tex
fontsize: 10pt
geometry: margin=1.5in
---

```{r, eval = FALSE}

# load library
library(traitdataform)

# load non-standardized dataset from BExIS 
# (requires access credentials and access rights)

moths <- read.service(21247, dec = ",")


# transform to observation long-table:

dataset1 <- as.traitdata(moths, 
                  taxa = "species",  # which column contains taxa?
                  traits = c("weight",   # which columns contain traits?
                             "wing_length", "wing_width", 
                             "wing_area", "wing_loading"
                             ),
                  units = c("mg", "mm", # which units do apply
                            "mm", "mm2", "mg/mm2"), 
                  keep = c(locationID = "plot") # which other cols to keep
                  )  


# standardize taxonomy:
# applies a matching of taxonomic names to GBIF backbone taxonomy

dataset1Std <- standardize.taxonomy(dataset1)  

# define a user-provided trait thesaurus:

traitlist <- as.thesaurus(data.frame(
  trait = c(
    "weight", 
    "wing_length",
    "wing_width",
    "wing_area",
    "wing_loading"
  ),
  traitDescription = c("dry weight of the individual", 
                       "the distance between base and apex (xi)", 
                       "the distance between tornus and costa (yi)", 
                       "wing_width x wing_length", 
                       "ratio of wing_area to body_mass"
                       ),
  valueType = c("numeric"),
  expectedUnit = c("mg", "mm", "mm", "mm2", "mg/mm2")
)
)


# standardize traits:

dataset1Std <- standardize.traits(dataset1Std, traitlist)


# standardize occurrence context by Exploratories Plot ID:

dataset1Std <- standardize.exploratories(dataset1Std)


# save to txt file, ready for BExIS upload: 
# omitting row names, use tab as field delimiter, 
# point as decimal delimiter, NA as missing value

write.table(dataset1Std, file = "mothtraitsStd.txt", 
            row.names = FALSE, 
            sep = "\t", 
            na = "NA", 
            dec = "."
            )

```
