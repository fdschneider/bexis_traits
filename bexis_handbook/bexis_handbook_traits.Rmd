---
title: "BExIS Manual for Traitdata"
author: "Florian D. Schneider"
date: "13 February 2018"
output:  
  pdf_document:
    includes:
      in_header: header.tex
    toc: yes
fontsize: 10pt
geometry: margin=1.5in
bibliography: ../manuscript/div05.bib
csl: ../manuscript/amnat.csl
---


# Ecological Traits

Ecological traits have become a core concept of ecological research and have been assessed for many organism groups within the Biodiversity Exploratories project. 

Sharing and harmonizing trait data into databases is a key task of biodiversity data management, but it relies on an unambiguous assignment of trait definitions and taxa, as well as clearly defined datasets. To facilitate the data handling by BExIS and other downstream services (e.g. GFBio or TRY) we defined a standard vocabulary for publishing trait datasets.

This document describes the main features of the standard vocabulary and how to prepare traitdata for upload into BExIS. 


# Traitdata vocabulary

The full set of terms can be accessed at https://ecologicaltraitdata.github.io/ETS/. 

The vocabulary proposed here is meant for two-dimensional spreadsheet data. These simple table formats are what a typical research project on a particular organism group and locality produces. The vocabulary includes a core section, as well as a series of terms which are used to define the level of the reported measurement or fact (e.g. measured on individuals, or reported for an entire species), or to relate it to a broader experimental or ecosystem context. The vocabulary also contains terms for describing metadata acompanying the trait dataset.^[Two-dimensional spreadsheets are limited in the number and complexity of measurements they can contain. For datasets containing multi-layered information on observations, traits, taxa and environmental context, we recommend the use relational datatabase structures composed of multiple spreadsheets linked via identifiers, like for example the generic trait database structure proposed by @kattge11a or the Traitbank structure proposed by @parr16, ideally compiled into Darwin Core Archives [DwC-A, @robertson09a]. ]

We assume that data are stored in a observation table, where each row is the reported measurement or fact for a single observation. At minimum, the following columns are required: 1. a value (column `traitValue`) and -- for numeric values -- a standard unit (`traitUnit`); 2. a descriptive trait name (`traitName`);  3. the scientific taxon for which the measurement or fact was obtained (`scientificName`).^[Another common format for trait data are species--trait matrices, where each row is a species and multiple trait values are stored in columns. These have to be converted into observation tables when applying the trait vocabulary.]
<!--For these core values, we highly recommend to use unambiguous and self-explanatory vocabularies for trait names and taxa. However, in order to keep the data compatible with own databases or analytical code, it might be necessary to use abbreviations or own identifiers. -->

## Identifiers

To make data compatible with a consensus standard of taxon names or a look-up tables of traits, it is highly recommended to map them to globally valid terminologies by adding globally valid identifiers for taxa (`taxonID`) and trait definitions (`traitID`), complemented by the more readable accepted names (`ScientificNameStd` and `traitNameStd`, respectively; e.g. GBIF Backbone Terminology)^[For *Bellis perennis*, the taxonID would be  'https://www.gbif.org/species/3117424'; in TOP Thesaurus, the traitID for 'fruit mass' would be  'http://top-thesaurus.org/annotationInfo?viz=1&&trait=Fruit_mass'].  

By allowing for a double record of both user-specific and standardised entries, we acknowledge the fact that most authors have their own schemes for standardisation which may refer to different scientific community standards  [as practiced in TRY; @kattge11]. This redundancy of data allows for continuity on the authors and data owners side while also ensuring quality checks and comparability for the data user.

## Extensions

Beyond measurement units or higher taxon information, further information might be available that may not be core data, but are related to the individual or specimen, or to the reported fact, measurement or sampling event. Here, the assignment of a unique identifier per single measurement event (`measurementID`) or individual occurrence (`occurrenceID`), defines the structure these data would take in a relational database context. 

The data standard provides two extensions of the vocabulary that should be used to describe these information:

- The `occurrence` extension (https://ecologicaltraitdata.github.io/ETS/#extension-occurrence) contains vocabulary to describe information on the level of individual specimens, such as sex, life stage or age. This also includes the method of sampling and preservation, as well as date and geographical location, which provides an important resource to analyse trait variation due to differences in space and time.
- The `measurementOrFact` extension (https://ecologicaltraitdata.github.io/ETS/#extension-measurement-or-fact) provides terms to describe information at the level of single measurements or reported facts, such as the original literature from where the value is cited, the method of measurement or statistical method of aggregation. It provides important information that allows for the tracking of potential sources of noise or bias in measured data (e.g. variation in measurement method) or aggregated values (e.g. statistical method applied), as well as the source of reported facts (e.g. literature source or expert reference).
- The `BiodiversityExploratories` extension  (http://ecologicaltraitdata.github.io/ETS/#extension-biodiversity-exploratories)  provides terms to relate the trait measurement to plots and sites in the exploratories framework, including `ExploratoriesPlotID`, `Exploratory` and `ExploType`


# R-package 'traitdataform'

We provide the R package 'traitdataform' to assist the production of data compliant with the trait data standard proposed here. There are two major use cases for the package:

1. preparing of own trait datasets for publication on low-threshold file-servers and project databases, and
2. automating the harmonisation of trait datasets from different sources by moulding them into a unified format^[The package offers direct access to trait datasets that have been published in the public domain or under creative commons licenses. See a full list of linked datasets on the package  website or by calling `data(package = "traitdataform")`. We invite users and authors of datasets to add further data to the package and thereby contribute to this registry for distributed trait datasets. ]. 

A comprehensive documentation of the package is found in the package website (http://EcologicalTraitData.github.io/traitdataform/), and on its Github repository (https://github.com/EcologicalTraitData/traitdataform).

Installation of the package is possible via the devtools package directly from Github:

```
install.packages('devtools')
devtools::install_github('EcologicalTraitData/traitdataform')
```

The key function of the package is `as.traitdata()`. This function maps column names into terms provided in the standard trait vocabulary and adds metadata as attributes to the output object. The function also will mould a species-trait-matrix into a observation table format. If data are measured on a single individual the function adds an occurrenceID to keep the reference context of individual measurements. This example converts an own file 'data.csv' into a dataset of long-table structure that employs the standard vocabulary for core data:

```
library("traitdataform")
dataset <- as.traitdata(read.csv("path/to/data.csv"), 
             traits = c("body_length", "antenna_length", 
                        "metafemur_length"),
             units = "mm",
             taxa = "name_correct", 
             keep = c(locationID = "location")
             )

```

The column containing taxon names is given in parameter 'taxa'. Note that the parameter 'keep' specifies and renames any data that should be maintained in the output. The parameter 'units' is used to specify the input units of measurement. 

In order to map user-provided names to unambiguous and globally unique identifiers, the function `standardize.taxonomy()` matches scientific taxon names automatically to the GBIF Backbone Taxonomy and adds the column `taxonID` to the core data. 
<!-- BKR: In the example below, this looks like a manual matching. What is done automatically here and which information does the user have to provide?  FDS: taxon is matched automatically, traits not. lack of trait APIs and webservices. --> 
Similarly, the `standardize.traits()` function matches user-provided trait names onto a given trait vocabulary and links it to an existing trait ontology or a user-provided table of trait definitions, i.e. a thesaurus of traits^[This requires some manual mapping. Please see the package website for instructions. Also note the trait thesaurus provided for the Exploratories (https://ecologicaltraitdata.github.io/TraitDataList/), which will be included in the package in due time.]. The same function harmonises trait values by converting values into target units and unified factor levels. 

The package functions form a toolchain where each function can be piped as an input into the next. A wrapper function `standardize()` applies all functions sequentially, making transferring and harmonizing traitdata as simple as:

```
datasetStd <- standardize(read.csv("path/to/data.csv"),
            thesaurus = traitlist,
            taxa = "name_correct", 
            units = "mm"
            )
```

For saving your data for upload in BExIS, you would use 

```
write.csv(datasetStd, file = "filename.csv", row.names = FALSE)
```

which and omits the row names when produces a comma separated file with points as decimal delimiter. 

# Upload to BExIS

When uploading the dataset to BExIS, you can use the predefined template "traitTemplate", which already contains a list of column definitions. 

On page 2: Most likely, the number of plots is irrelevant to your trait data, but assign whether it is about organisms from the grassland or the forest plots (or experimental manipulation), or from above or below ground system. The taxon field is of particular importance here. The field 'bioticDataTypes'  should be set to "Trait Data". 

On page 3: describe the methodology underlying your trait values thoroughly. If data were extracted from literature or other database sources, declare that data are "literature data" and - if applicable - point to the column "basisOfRecord" where you should distinguish the source of your data.

On page 4: When providing keywords, you should specify which kind of traits are reported (e.g. "morphological", "behaviour", "life-history", "functional"). 

On page 5: Please pay attention to select the correct time format, if sampling or measuring dates are given (most likely, "yyyy-MM-dd").  

On page 6: Set 'exploratory' and 'keyPlots' to 'none' if your trait data are not assigned to a single plot and site. If you created a .txt or .csv file from the R package, chose fileFormat 'ASCII' and pay attention to the field delimiter and decimal Character. Missing values created by the R package are empty fields, thus enter "".  Known missing values (i.e. values have not been measured for any reason) should not exist in the observation table format (the R package eliminates them by default). If you chose to keep rows for lacking trait measurements in the table, they should be marked as "NA". The section on 'matrix data' should be irrelevant if the data have been correctly transferred into observation tables. The variables (i.e. column names) are already provided by the template. You may add non-standard columns if necessary. 


<!--Eliminate columns that are not present in your dataset. 
--> 

On page 7: if the trait data are extracted from one or multiple existing databases, it is necessary to refer to those here (by name and by original paper reference). If the data have been uploaded before in a non-standard format, please provide the dataset ID. 


# References